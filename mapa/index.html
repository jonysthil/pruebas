<meta charset="utf-8">
<script type='text/javascript' src='http://maps.google.com/maps/api/js?sensor=true'></script>
<style type='text/css'>
#googleMap
{
	width:  100%;
	height: 600;
}
</style>
<script>
var direccion;
var localizacion;
var myCenter;
var marker;
var lat = "19.4328054";
var lon = "-99.1336855";
var zoom = 15;
var map;


myCenter=new google.maps.LatLng(lat,lon);

function initialize()
{
	var mapProp = {
		center:myCenter,
		zoom: zoom,
		mapTypeId:google.maps.MapTypeId.ROADMAP
	};

	map = new google.maps.Map(document.getElementById('googleMap'),mapProp);
	
	google.maps.event.addListener(map, 'click', function(event) {

		if(marker!=null){
			marker.setMap(null);
		}
		placeMarker(event.latLng);
	});
}

google.maps.event.addDomListener(window, 'load', initialize);


function placeMarker(location)
{
	marker = new google.maps.Marker({
		position: location,
		map: map,
		draggable: true,
		animation: google.maps.Animation.BOUNCE
	});

	google.maps.event.addListener(marker, 'mouseup', function(event) {
		setPosicion(event.latLng.lat(),event.latLng.lng());
	});	

	setPosicion(location.lat(),location.lng());
}

function setPosicion(lat,lon)
{
	document.forma.em_latitud.value=lat;
	document.forma.em_longitud.value=lon;
}

function buscar()
{
	direccion = document.getElementById('direccion').value;
	geocoder = new google.maps.Geocoder();

	if (geocoder)
	{
		geocoder.geocode( { 'address': direccion}, function(results, status)
		{
			if (status == google.maps.GeocoderStatus.OK)
			{
				localizacion = results[0].geometry.location;
				myCenter = new google.maps.LatLng(localizacion.lat(),localizacion.lng());

				initialize();	

			}
			else
			{
				alert("Error: No se logró obtener la dirección.");
			}
		});
	}
}
</script>



<form name='forma' action='' method='post'>
<input type='hidden' name='a' value='i'>
<input type='hidden' name='evt_id' value='".$_VAR["evt_id"]."'>

<table>
<tr><td>Buscar dirección</td><td><input type='text' name='direccion' id='direccion' value='' size='30'>&nbsp;<input type='button' value='Buscar' onclick='buscar();'></td></tr>
<tr><td>Latitud</td><td><input type='text' name='em_latitud'  value='' size='30' readonly></td></tr>
<tr><td>Longitud</td><td><input type='text' name='em_longitud' value='' size='30' readonly></td></tr>
<tr><td></td><td><input type='submit' value='Guardar'>&nbsp;<input type='button' value='Cancelar' onclick='history.back();'></td></tr>
<tr><td colspan='2'><i>Nota:<br>Para obtener la latitud y la longitud solo hay que hacer click en el mapa</i></td></tr>
</table>

</form>

<div id='googleMap'></div>

